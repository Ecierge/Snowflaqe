<Project >
    <PropertyGroup>
        <!--<SnowflaqeGeneratedFiles />-->
        <BuildDependsOn>
            GenerateGraphQLClient;
            $(BuildDependsOn)
        </BuildDependsOn>
    </PropertyGroup>
    <ItemGroup>
        <PackageReference Update="FSharp.Core" Version="5.0.1" />
        <PackageReference Include="Fable.Remoting.Json" Version="2.14.0" Condition="$(SnowflaqeTarget) == 'fable'" />
    </ItemGroup>
    <PropertyGroup>
        <TaskFolder Condition=" '$(MSBuildRuntimeType)' == 'Core' ">MSBuildCore</TaskFolder>
        <TaskFolder Condition=" '$(MSBuildRuntimeType)' != 'Core' ">MSBuildFull</TaskFolder>
        <TaskAssembly>$(MSBuildThisFileDirectory)..\build\$(TaskFolder)\Snowflaqe.Tasks.dll</TaskAssembly>
    </PropertyGroup>
    <UsingTask
        TaskName="Snowflaqe.Tasks.GenerateGraphQLClient"
        AssemblyFile="$(TaskAssembly)" />
    <Target Name="GenerateGraphQLClient" BeforeTargets="BeforeReBuild">
        <GenerateGraphQLClient
            Project="Spotify"
            Queries="queries"
            Schema="spotify-schema.json"
            Configuration="$(Configuration)"
            Platform="$(Platform)"
            Target="fsharp">
            <Output TaskParameter="GeneratedFiles" ItemName="SnowflaqeGeneratedFiles" />
        </GenerateGraphQLClient>
        <Message Text="Generated files:" Importance="high" />
        <Message Text="@(SnowflaqeGeneratedFiles)" />
        <ItemGroup>
            <Compile Include="@(SnowflaqeGeneratedFiles)" />
        </ItemGroup>
    </Target>
  <Target Name="IncludeGraphQLClient" BeforeTargets="BeforeBuild">
    <Import Project="Spotify" Include="$(CommonLocation)\obj\$(Configuration)\$(Platform)\*.props" Condition="Exists('$(CommonLocation)\obj\$(Configuration)\$(Platform)\*.props')"/>
  </Target>
</Project>
